// const { spawnSync } = require('child_process')
// const path = require('path')

import { spawnSync } from 'child_process'
import path from 'path'
import { fileURLToPath } from 'url'

const __filename = fileURLToPath(import.meta.url)
const __dirname = path.dirname(__filename)

// console.log('Current filename:', __filename);
console.log('Current directory:', __dirname)

const result = spawnSync(
    process.execPath,
    [
        // Use --experimental-vm-modules if your Node version is <18 and you hit issues (sometimes not needed for 18+)
        // '--experimental-vm-modules',
        path.join(__dirname, 'test-esm.mjs'),
    ],
    { stdio: 'inherit' },
)

if (result.status !== 0) {
    throw new Error('ESM smoke test failed!')
} else {
    console.log('ESM smoke test succeeded!')
}
